<% content_for :body_class, "page-body" %>
<div class="page-container">
  <div class="sidebar-menu">
    <%=render :partial => "layouts/dashboard_menuheader" %>
    <%=render :partial => "layouts/dashboard_menu" %>
  </div>
  <div class="main-content">
    <%=render :partial => "layouts/dashboard_topbar" %>
    <ol class="breadcrumb bc-3">
      <li>
        <a href="<%=url_for :controller => "dashboard", :action => "index" %>"><i class="entypo-home"></i>Dashboard</a>
      </li>
      <li>
        <a href="<%=url_for :controller => "admin", :action => "index" %>">Admin</a>
      </li>
      <li class="active">
        <strong>All users</strong>
      </li>
    </ol>
    <h2>All users</h2>
    <br />
    <div class="row">
      <div class="col-md-12">
        <table class="table table-striped responsive">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Devices</th>
              <th>Menus</th>
              <th>Dishes</th>
              <th>Daily dishes (all)</th>
            </tr>
          </thead>
          <tbody>
            <% User.all.order(:name).each do |user| %>
            <tr style="font-size: 16px;">
              <td>
                <a href="<%=url_for :controller => "admin", :action => "user_switch", :user_id => user.id %>">
                  <%=user.name %>
                </a>
              </td>
              <td>
                <%=user.email %>
              </td>
              <td>
                <%=user.devices.where(["updated_at >= (?)", DateTime.now-31.days]).count %>
              </td>
              <td>
                <%=user.menus.count %>
              </td>
              <td>
                <%=user.dishes.count %>
              </td>
              <td>
                <%=user.daily_dishes.where(:display_date => Date.today).count %> (<%=user.daily_dishes.count %>)
              </td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>