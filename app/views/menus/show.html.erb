<ol class="breadcrumb bc-3">
	<li>
		<a href="<%= dashboard_index_path %>">
			<i class="entypo-home"></i>
			<%=t("layouts.menu.dashboard") %>
		</a>
	</li>
	<li class="">
		<a href="<%= menus_path %>">
			<%=t("menumalist.menu.menumalist") %>
		</a>
	</li>
	<li class="active">
		<strong><%=@menu.title %></strong>
	</li>
</ol>
<h2><%=@menu.title %></h2>
<br />
<div class="row gallery-env draggable-portlets">
	<%= form_tag(menu_sort_categories_path(@menu), {:multipart => true, :role => "form", :class => "pl8es_c_ajaxform_noreload", :id => "form_sort_category"}) do %>
		<span class="sorted ui-sortable">
			<% if @menu.categories.roots.any? %>
				<% @menu.categories.roots.each do |category| %>
					<%= render "categories/category", :category => category %>
				<% end %>
			<% end %>
		</span>
	<% end %>
	
	<%=render "modals/new_object_tile", :new_object_path => new_menu_category_path(@menu), :model => Category %>
</div>

<script type="text/javascript">
	jQuery(document).ready(function($)
	{
		$(function(){
			var $draggable_portlets = $(".draggable-portlets");
			
			$(".draggable-portlets .sorted").sortable({
				connectWith: ".draggable-portlets .sorted",
				handle: '.panel-heading',
				start: function()
				{
					$draggable_portlets.addClass('dragging');
				},
				stop: function()
				{
					$("#form_sort_category .panel input[name^='category_ids[']").each(function(i){
						$(this).val(i);
					});
					$draggable_portlets.removeClass('dragging');
					$("#form_sort_category").submit();
				}
			});
			$(".draggable-portlets .sorted .panel-heading").disableSelection();
		});
	});
</script>