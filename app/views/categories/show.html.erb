<ol class="breadcrumb bc-3">
	<li>
		<a href="<%= dashboard_index_path %>">
			<i class="entypo-home"></i>
			<%=t("layouts.menu.dashboard") %>
		</a>
	</li>
	<li class="">
		<a href="<%= menus_path %>">
			<%=t("menumalist.menu.menumalist") %>
		</a>
	</li>
	<li class="">
		<a href="<%= menu_path(@menu) %>">
			<%=@category.menu.title %>
		</a>
	</li>
	<% if @category.parent.present? %>
		<li class="">
			<a href="<%= menu_category_path(@menu, @category.parent) %>">
				<%=@category.parent.title %>
			</a>
		</li>
	<% end %>
	<li class="active">
		<strong><%=@category.title %></strong>
	</li>
</ol>

<h2><%=@category.menu.title %> - <%=@category.title %></h2>
<br />
<div class="row gallery-env draggable-portlets">
	<%= form_tag(menu_sort_categories_path(@menu), {:multipart => true, :role => "form", :class => "pl8es_c_ajaxform_noreload", :id => "form_sort_category"}) do %>
		<span class="sorted ui-sortable">
			<%= render @category.children %>
		</span>
	<% end %>
	
	<%= form_tag(sort_dishes_path, {:multipart => true, :role => "form", :class => "pl8es_c_ajaxform_noreload", :id => "form_sort_dish"}) do %>
		<span class="sorted ui-sortable">
			<%= render @category.dishes %>
		</span>
	<% end %>
	
	<% if @category.parent.blank? && @category.dishes.blank? %>
		<%= render "modals/new_object_tile", :new_object_path => new_menu_category_path(@menu.id, :parent_id => @category.id), :model => Category %>
	<% end %>
	
	<% if @category.children.blank? %>
		<%= render "modals/new_object_tile", :new_object_path => new_dish_path(:category_id => params[:id]), :model => Dish, :big => true %>
	<% end %>
</div>

<script type="text/javascript">
	jQuery(document).ready(function($)
	{
		$(function(){
			var $draggable_portlets = $(".draggable-portlets");
			
			$(".draggable-portlets .sorted" ).sortable({
				connectWith: ".draggable-portlets .sorted",
				handle: '.panel-heading',
				start: function()
				{
					$draggable_portlets.addClass('dragging');
				},
				stop: function()
				{
					$draggable_portlets.removeClass('dragging');
					
					var f = $(this).closest("form");
					if (f.attr("id") == "form_sort_category")
					{
						$("#form_sort_category .panel input[name^='category_ids[']").each(function(i){
							$(this).val(i);
						});
						$("#form_sort_category").submit();
					}
					else if (f.attr("id") == "form_sortdish")
					{
						$("#form_sortdish .panel input[name^='dish_ids[']").each(function(i){
							$(this).val(i);
						});
						$("#form_sortdish").submit();
					}
				}
			});
			$(".draggable-portlets .sorted .panel-heading").disableSelection();
		});
	});
</script>